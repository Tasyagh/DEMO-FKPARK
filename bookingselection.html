<!DOCTYPE html>
<html lang="en">
<head>
    <title>FKPARK | BOOKING SELECTION</title>
    <!-- Favicon -->   
    <link rel="icon" href="https://umpsa.edu.my/themes/pana/favicon.ico" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <style>
      .card-value {
        font-size: 36px;
        font-weight: bold;
        color: #15a195;
      }
      body {
        font: 400 15px Lato, sans-serif;
        line-height: 1.8;
        color: #818181;
        background-size: cover; 
        background-image: url('background_img/umpbge.png');
      }
      .slideanim {
        visibility:hidden;
      }
      .slide {
        animation-name: slide;
        -webkit-animation-name: slide;
        animation-duration: 1s;
        -webkit-animation-duration: 1s;
        visibility: visible;
      }
      @keyframes slide {
        0% {
          opacity: 0;
          transform: translateY(70%);
        } 
        100% {
          opacity: 1;
          transform: translateY(0%);
        }
      }
      @-webkit-keyframes slide {
        0% {
          opacity: 0;
          -webkit-transform: translateY(70%);
        } 
        100% {
          opacity: 1;
          -webkit-transform: translateY(0%);
        }
      }
      @media screen and (max-width: 768px) {
        .col-sm-4 {
          text-align: center;
          margin: 25px 0;
        }
        .btn-lg {
          width: 100%;
          margin-bottom: 35px;
        }
      }
      @media screen and (max-width: 480px) {
        .logo {
          font-size: 150px;
        }
      }
      .container-fluid {
        padding: 60px 50px;
      }
      .sidenav {
        height: 100%;
        width: 300px;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: white;
        overflow-x: hidden;
        padding-top: 70px;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        transition: 0.5s;
      }
      .main {
        margin-left: 300px; 
        padding: 20px;
        transition: margin-left 0.5s;
      }
      .sidenav a {
        padding-bottom: 5px;
        text-decoration: none;
        font-size: 16px;
        color: #333;
        display: block;
        transition: 0.3s;
      }
      .sidenav a:hover {
        background-color: #f5f5f5;
        }
      .sidenav .button {
        background-color: #59c5bc;
        border: solid black 0px;
        padding: 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        border-radius: 30px;
        width: 265px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        transition: all 0.3s;
      }
      .sidenav .button:hover {
        background-color: #3ddacd;
        transform: translateX(1px);
      }
      .sidenav img.logo {
        width: 60%;
        margin-bottom: 20px;
      }
      .cards-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 20px;
      }
      .parking-card {
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        width: calc(20% - 16px);
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .card-header {
        font-weight: bold;
        margin-bottom: 10px;
        font-size: 18px;
      }
      .card-detail {
        margin: 5px 0;
      }
      .filter-container {
        background-color: white;
        text-align: center;
        border: 1px solid #ddd;
        padding: 15px;
        margin-bottom: 20px;
      }
      .filter-container select {
        border: 1px solid #ddd;
        padding: 8px 12px;
        border-radius: 4px;
        width: 20%;
        margin: 0 5px;
      }
      .bookbtn {
        background-color: #a9d1d7;
        color: black;
        border: none;
        padding: 10px 16px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 4px;
      }
      .bookbtn:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      .savebtn {
        background-color: #59c5bc;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .savebtn:hover {
        background-color: #3ddacd;
      }
      .user-info {
        background-color: white;
        text-align: center;
        border: 1px solid #ddd;
        padding: 10px;
        margin-bottom: 20px;
      }
      @media (max-width: 1200px) {
        .parking-card {
          width: calc(25% - 16px);
        }
      }
      @media (max-width: 992px) {
        .parking-card {
          width: calc(33.33% - 16px);
        }
      }
      @media (max-width: 768px) {
        .parking-card {
          width: calc(50% - 16px);
        }
        .filter-container select, .savebtn {
          width: 30%;
        }
      }
      /* Mobile styles */
      @media (max-width: 768px) {
        .sidenav {
          width: 0;
          padding-top: 15px;
        }
        .main {
          margin-left: 0;
        }
        .openbtn {
          font-size: 20px;
          cursor: pointer;
          background-color: #59c5bc;
          color: white;
          padding: 10px 15px;
          border: none;
          position: fixed;
          top: 10px;
          left: 10px;
          z-index: 2;
          border-radius: 5px;
          transition: left 0.5s;
        }
        .openbtn:hover {
          background-color: #3ddacd;
        }
        .sidenav .button {
          width: 90%;
        }
        .sidenav img.logo {
          width: 50%;
        }
        /* When sidebar is open */
        .sidenav.open {
          width: 250px;
        }
        .main.sidebar-open {
          margin-left: 250px;
        }
        .openbtn.sidebar-open {
          left: 260px;
        }
      }
    </style>
</head>
<body id="myPage" data-spy="scroll" data-target=".navbar" data-offset="50">
    <!-- Mobile menu button -->
    <button class="openbtn" id="openBtn">☰</button>
    
    <!--Side Navigation Bar-->
    <div class="sidenav" id="mySidenav">
        <center><img class="logo" src="background_img/l.png"></center><br>
        <a href="dashboard.html"><div class="button">Dashboard</div></a>
        <a href="bookingselection.html"><div class="button">Booking</div></a>
        <a href="#Parking_Module4"><div class="button">Parking</div></a>
        <a href="#Summon_Module4"><div class="button">Summon</div></a>
        <a href="#Vehicle_Module2"><div class="button">Vehicle</div></a>
        <a href="#Account_Module1"><div class="button">Account</div></a>
        <a href="index.html"><div class="button">Log Out</div></a>
    </div>
    <div class="main" id="mainContent">
        <br><br>
        <!--Header for page Link-->
        <a href="bookingselection.html">
            <b>Booking Selection | </b>
        </a> 
        <a href="mybooking.html">
            My Booking
        </a>
        <br><br>
        <!--User Information-->
        <div class="user-info">
            <p>USER: <span id="usernameDisplay"></span></p>
        </div>
        <br>
        <!--Filter-->
        <div class="filter-container">
            <label for="parking_type">Parking Type:</label>
            <select id="parking_type">
                <option value="">All</option>
                <option value="B">B</option>
                <option value="A">A</option>
            </select>
            <label for="parking_status">Parking Status:</label>
            <select id="parking_status">
                <option value="">All</option>
                <option value="Available">Available</option>
                <option value="NOT available">Not Available</option>
            </select>
            <button class="savebtn" id="filterBtn">FILTER</button>
        </div>
        <br>
        <!--Cards Information-->
        <div class="cards-container" id="parkingCards">
            <!-- Parking cards will be generated by JavaScript -->
        </div>
    </div>

    <script>
        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            const loggedIn = sessionStorage.getItem('loggedIn');
            const username = sessionStorage.getItem('username');
            
            if (!loggedIn || loggedIn !== 'true') {
                window.location.href = 'login.html';
                return;
            }
            
            // Display username
            document.getElementById('usernameDisplay').textContent = username;
            
            // Mock parking data
            const parkingData = [
                { id: 1, number: 'B101', type: 'B', status: 'Available' },
                { id: 2, number: 'B102', type: 'B', status: 'Available' },
                { id: 3, number: 'B103', type: 'B', status: 'NOT available' },
                { id: 4, number: 'B104', type: 'B', status: 'Available' },
                { id: 5, number: 'B105', type: 'B', status: 'Available' },
                { id: 6, number: 'B106', type: 'B', status: 'NOT available' },
                { id: 7, number: 'B107', type: 'B', status: 'Available' },
                { id: 8, number: 'B108', type: 'B', status: 'NOT available' },
                { id: 9, number: 'B109', type: 'B', status: 'Available' },
                { id: 10, number: 'B110', type: 'B', status: 'Available' },
            ];
            
            // Function to render parking cards
            function renderParkingCards(filterType = '', filterStatus = '') {
                const container = document.getElementById('parkingCards');
                container.innerHTML = '';
                
                const filteredData = parkingData.filter(parking => {
                    const typeMatch = filterType ? parking.type === filterType : true;
                    const statusMatch = filterStatus ? parking.status === filterStatus : true;
                    return typeMatch && statusMatch;
                });
                
                if (filteredData.length === 0) {
                    container.innerHTML = '<p style="width:100%; text-align:center;">No parking spots match your filters</p>';
                    return;
                }
                
                filteredData.forEach(parking => {
                    const card = document.createElement('div');
                    card.className = 'parking-card slideanim slide';
                    card.innerHTML = `
                        <center>
                            <form onsubmit="handleBooking(event, ${parking.id})">
                                <input type="hidden" name="parking_id" value="${parking.id}">
                                <div class="card-header">Parking Lot</div>
                                <div class="card-value">${parking.number}</div>
                                <div class="card-detail"><strong>Type:</strong> ${parking.type}</div>
                                <div class="card-detail"><strong>Status:</strong> </div>
                                <div class="card-detail">${parking.status}</div>
                                <button type="submit" name="book" id="book" class="bookbtn" ${parking.status === 'NOT available' ? 'disabled' : ''}>
                                    BOOK
                                </button>
                            </form>
                        </center>
                    `;
                    container.appendChild(card);
                });
            }
            
            // Initial render
            renderParkingCards();
            
            // Filter button click handler
            document.getElementById('filterBtn').addEventListener('click', function() {
                const typeFilter = document.getElementById('parking_type').value;
                const statusFilter = document.getElementById('parking_status').value;
                renderParkingCards(typeFilter, statusFilter);
            });
            
            // Handle booking
            window.handleBooking = function(event, parkingId) {
                event.preventDefault();
                const parkingSpot = parkingData.find(p => p.id === parkingId);
                
                if (parkingSpot && parkingSpot.status === 'Available') {
                    // Update status immediately for visual feedback
                    parkingSpot.status = 'NOT available';
                    renderParkingCards(
                        document.getElementById('parking_type').value,
                        document.getElementById('parking_status').value
                    );
                    
                    // Store booking in sessionStorage
                    const bookings = JSON.parse(sessionStorage.getItem('bookings') || '[]');
                    bookings.push({
                        id: Date.now(),
                        parkingId: parkingId,
                        parkingNumber: parkingSpot.number,
                        date: new Date().toISOString(),
                        username: username
                    });
                    sessionStorage.setItem('bookings', JSON.stringify(bookings));
                    
                    // Show success message
                    alert(`Successfully booked parking spot ${parkingSpot.number}`);
                    
                    // Wait 2 seconds to ensure UI updates are visible, then redirect
                    setTimeout(() => {
                        window.location.href = 'mybooking.html';
                    }, 2000);
                } else {
                    alert('This parking spot is no longer available');
                }
            };
            
            // Mobile menu toggle
            const openBtn = document.getElementById('openBtn');
            const sidenav = document.getElementById('mySidenav');
            const mainContent = document.getElementById('mainContent');
            
            openBtn.addEventListener('click', function() {
                const isOpen = sidenav.classList.toggle('open');
                mainContent.classList.toggle('sidebar-open');
                openBtn.classList.toggle('sidebar-open');
                
                // Change icon based on state
                openBtn.textContent = isOpen ? '✕' : '☰';
            });
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 768) {
                    const isClickInside = sidenav.contains(event.target) || openBtn.contains(event.target);
                    if (!isClickInside && sidenav.classList.contains('open')) {
                        sidenav.classList.remove('open');
                        mainContent.classList.remove('sidebar-open');
                        openBtn.classList.remove('sidebar-open');
                        openBtn.textContent = '☰';
                    }
                }
            });
        });
    </script>
</body>
</html>